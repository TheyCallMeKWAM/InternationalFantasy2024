<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Submission Form</title>
    <link rel="stylesheet" href="CSS_FIles/submit.css"> <!-- Link to external CSS file -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAQJdbBj21r9Cy_p7JmMCOgOnFCidWJXyU",
            authDomain: "international-fantasy.firebaseapp.com",
            databaseURL: "https://international-fantasy-default-rtdb.firebaseio.com",
            projectId: "international-fantasy",
            storageBucket: "international-fantasy.appspot.com",
            messagingSenderId: "1084078376703",
            appId: "1:1084078376703:web:18b55b0d166e34a4782eca"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        document.addEventListener("DOMContentLoaded", function() {
            const teams = {
            "Team Spirit": ["Raddan", "Larl", "Collapse", "Mira", "Miposhka"],
            "Xtreme Gaming": ["Ame", "Xm", "Xxs", "XinQ", "Dy"],
            "Team Falcons": ["skiter", "Malr1ne", "AMMAR_THE_F", "Cr1t-", "Sneyking"],
            "Team Liquid": ["miCKe", "Nisha", "33", "Boxi", "Insania"],
            "Gaimin Gladiators": ["dyrachyo", "Quinn", "Ace ♠", "tOfu", "Seleri"],
            "BetBoom Team": ["Saika", "gpk~", "MieRo`", "Save-", "TORONTOTOKYO"],
            "Cloud9": ["医者watson`", "No[o]ne-", "DM", "Kataomi`", "Fishman"],
            "Tundra Esports": ["Pure", "Topson", "Tobi", "9Class", "Whitemon"],
            "1win": ["Munkushi~", "CHIRA_JUNIOR", "Cloud", "swedenstrong", "RESPECT"],
            "Team Zero": ["YSR-04E", "7eeeeeee", "Beyond", "ponlo", "zzq"],
            "G2 x iG": ["Monet", "NothingToSay", "-JT", "BoBoKa", "xNova"],
            "Talon Esports": ["Akashi", "Mikoto", "Ws`", "Jhocam", "ponyo"],
            "Aurora": ["23savage", "lorenof", "Jabz", "Q", "Oli~"],
            "nouns": ["Yuma", "Copy", "Gunnar", "Lelis", "Fly"],
            "HEROIC": ["k1 hector tqmM", "4nalog <01", "Davai Lama", "Scofield", "KingJungles"],
            "beastcoast": ["payk", "Lumpy", "Vitaly 誇り", "Elmisho", "MoOz"]
        };

            const nameInputId = "userName";
            const cptDropdownId = "cpt";
            const carryDropdownIds = ["carry1", "carry2", "carry3"];
            const supportDropdownIds = ["support4", "support5"];
            const teamDropdownId = "teamDropdown";
            function clearDropdown(id) {
                const dropdownMenu = document.getElementById(id);
                dropdownMenu.innerHTML = ""; // Clear existing options
            }
            function populateDropdown(id, teams, filterFunction, placeholderText) {
                const dropdownMenu = document.getElementById(id);
                clearDropdown(id);
                // Add placeholder option
                const placeholderOption = document.createElement("option");
                placeholderOption.text = placeholderText;
                placeholderOption.value = "";
                placeholderOption.disabled = true;
                placeholderOption.selected = true;
                dropdownMenu.appendChild(placeholderOption);
                for (const team in teams) {
                    let optgroup = document.createElement("optgroup");
                    optgroup.label = team;
                    teams[team].filter(filterFunction).forEach(player => {
                        let option = document.createElement("option");
                        option.text = player;
                        option.value = player;
                        optgroup.appendChild(option);
                    });
                    dropdownMenu.appendChild(optgroup);
                }
            }
            // Populate Captain dropdown (all players) with placeholder "Select Captain"
            populateDropdown(cptDropdownId, teams, () => true, "CPT");
            // Populate Carry dropdowns (first 3 players) with placeholder "Select Core"
            carryDropdownIds.forEach(id => {
                populateDropdown(id, teams, (player, index) => index < 3, "CORE");
            });
            // Populate Support dropdowns (last 2 players) with placeholder "Select Support"
            supportDropdownIds.forEach(id => {
                populateDropdown(id, teams, (player, index, array) => index >= array.length - 2, "SUPPORT");
            });
            // Function to populate dropdown with just team names with placeholder "Select Team"
            function populateTeamDropdown() {
                const dropdownMenu = document.getElementById(teamDropdownId);
                clearDropdown(teamDropdownId);
                // Add placeholder option
                const placeholderOption = document.createElement("option");
                placeholderOption.text = "TEAM";
                placeholderOption.value = "";
                placeholderOption.disabled = true;
                placeholderOption.selected = true;
                dropdownMenu.appendChild(placeholderOption);
                for (const team in teams) {
                    let option = document.createElement("option");
                    option.text = team;
                    option.value = team;
                    dropdownMenu.appendChild(option);
                }
            }
            // Call populateTeamDropdown function
            populateTeamDropdown();
            // Function to check if all fields are filled out
            function areAllFieldsFilled() {
                const userName = document.getElementById(nameInputId).value;
                const cpt = document.getElementById(cptDropdownId).value;
                const carry1 = document.getElementById("carry1").value;
                const carry2 = document.getElementById("carry2").value;
                const carry3 = document.getElementById("carry3").value;
                const support4 = document.getElementById("support4").value;
                const support5 = document.getElementById("support5").value;
                const team = document.getElementById("teamDropdown").value;
                return userName && cpt && carry1 && carry2 && carry3 && support4 && support5 && team;
            }
            // Function to check if any dropdowns have duplicate values
            function haveDuplicateSelections() {
                const values = [
                    document.getElementById(cptDropdownId).value,
                    document.getElementById("carry1").value,
                    document.getElementById("carry2").value,
                    document.getElementById("carry3").value,
                    document.getElementById("support4").value,
                    document.getElementById("support5").value,
                    document.getElementById("teamDropdown").value
                ];
                const uniqueValues = new Set(values);
                return uniqueValues.size !== values.length;
            }
            // Function to check if more than 4 selections are from the same team
            function isTeamLimitExceeded() {
                const teamCounts = {};
                const teamName = document.getElementById("teamDropdown").value;
                const values = [
                    document.getElementById(cptDropdownId).value,
                    document.getElementById("carry1").value,
                    document.getElementById("carry2").value,
                    document.getElementById("carry3").value,
                    document.getElementById("support4").value,
                    document.getElementById("support5").value
                ];
                values.forEach(player => {
                    for (const team in teams) {
                        if (teams[team].includes(player)) {
                            if (!teamCounts[team]) {
                                teamCounts[team] = 0;
                            }
                            teamCounts[team]++;
                        }
                    }
                });
                if (teamName) {
                    if (!teamCounts[teamName]) {
                        teamCounts[teamName] = 0;
                    }
                    teamCounts[teamName]++;
                }
                return Object.values(teamCounts).some(count => count > 4);
            }
            document.getElementById("submitButton").addEventListener("click", function() {
                if (!areAllFieldsFilled()) {
                    alert("Please fill out all fields.");
                    return;
                }
                if (haveDuplicateSelections()) {
                    alert("Please ensure no two dropdowns have the same value.");
                    return;
                }
                if (isTeamLimitExceeded()) {
                    alert("You cannot select more than 4 players from the same team.");
                    return;
                }
                const userName = document.getElementById(nameInputId).value;
                const cpt = document.getElementById(cptDropdownId).value;
                const carry1 = document.getElementById("carry1").value;
                const carry2 = document.getElementById("carry2").value;
                const carry3 = document.getElementById("carry3").value;
                const support4 = document.getElementById("support4").value;
                const support5 = document.getElementById("support5").value;
                const team = document.getElementById("teamDropdown").value;
                const submissionsRef = ref(database, 'submissions/');
                const newSubmissionRef = push(submissionsRef);
                const submissionData = {
                    userName: userName,
                    captain: cpt,
                    carry1: carry1,
                    carry2: carry2,
                    carry3: carry3,
                    support4: support4,
                    support5: support5,
                    team: team
                };
                set(newSubmissionRef, submissionData)
                    .then(() => {
                        console.log('Data submitted successfully.');
                    })
                    .catch((error) => {
                        console.error('Error submitting data: ', error);
                    });
            });
        });
    </script>
</head>
<body>
    <div class="navbar">
        <div class="links">
            <a href="index.html">LEADERBOARD</a>
            <a href="submit.html">SUBMIT LINEUP</a>
        </div>
        <div class="links">
            <a href="https://liquipedia.net/dota2/The_International/2024" target=”_blank>LIQUIPEDIA</a>
        </div>
    </div>


    <video autoplay muted loop id="myVideo">
        <source src="/Images/ti10_background.mp4" type="video/mp4">
      </video>

    <div class="container">
        <div class="header">FANTASY SUBMISSION FORM</div>
        <input type="text" id="userName" placeholder="NAME">
        <select id="cpt"></select>

        <div class="form-row">
            <select id="carry1"></select>
            <select id="carry2"></select>
            <select id="carry3"></select>
        </div>

        <div class="support-row">
            <select id="support4"></select>
            <select id="support5"></select>
        </div>

        <select id="teamDropdown"></select>
        <button type="button" id="submitButton">Submit</button>
    </div>
</body>
</html>
